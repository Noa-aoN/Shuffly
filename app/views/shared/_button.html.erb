<% f = local_assigns.fetch(:f, nil) %>
<% button_text = local_assigns.fetch(:button_text, '') %>
<% path = local_assigns.fetch(:path, '#') %>
<% variant = local_assigns.fetch(:variant, 'primary') %>
<% size = local_assigns.fetch(:size, 'md') %>
<% full_mobile = local_assigns.fetch(:full_mobile, true) %>
<% disabled = local_assigns.fetch(:disabled, false) %>
<% extra_class = local_assigns.fetch(:extra_class, '') %>
<% id = local_assigns.key?(:id) ? local_assigns[:id] : nil %>
<% data_action = local_assigns.key?(:data_action) ? local_assigns[:data_action] : nil %>

<%# 新規オプション: icon (asset パス or URL), icon_class, icon_alt, 既に構築済みの icon_html があれば優先する %>
<% icon_html = local_assigns.fetch(:icon_html, nil) %>
<% icon = local_assigns.fetch(:icon, nil) %>
<%# アイコンとテキストの間は全角スペース1つで制御する %>
<% icon_class = local_assigns.fetch(:icon_class, 'inline-block align-middle') %>
<% icon_alt = local_assigns.fetch(:icon_alt, '') %>

<% base = "inline-flex items-center justify-center rounded-xl font-bold focus:outline-none focus:ring-2 focus:ring-offset-2 transition shadow-lg md:min-w-[180px] lg:min-w-[310px]" %>

<% size_classes = {
  'sm' => 'px-3 py-1 text-sm min-h-[40px]',
  'md' => 'px-4 py-2 text-sm min-h-[44px]',
  'lg' => 'px-5 py-3 text-base min-h-[48px]'
} %>

<% variant_classes = {
  'primary' => 'bg-blue-500 text-white hover:bg-blue-600 focus:ring-blue-500 border border-slate-200',
  'secondary' => 'bg-gray-100 text-gray-800 hover:bg-gray-200 focus:ring-gray-400 border border-slate-200',
  'ghost' => 'bg-transparent text-blue-700 hover:bg-blue-100 focus:ring-blue-200 border border-slate-200',
  'danger' => 'bg-red-500 text-white hover:bg-red-600 focus:ring-red-500 border border-slate-200'
} %>

<% size_class = size_classes[size] || size_classes['md'] %>
<% var_class = variant_classes[variant] || variant_classes['primary'] %>
<% responsive_class = full_mobile ? 'w-full sm:w-auto' : 'inline-block' %>
<% web_text_adjust = 'md:text-[16px]' %>
<% classes = [base, size_class, var_class, responsive_class, web_text_adjust, extra_class].join(' ').squeeze(' ').strip %>

<%# icon_html が未指定かつ icon が渡されている場合に生成する。アイコンの色はボタンの文字色に合わせる（text-white が含まれる場合は白く、それ以外は黒系のまま） %>
<% if icon_html.blank? && icon.present? %>
  <% src = (begin; asset_path(icon) rescue icon; end) %>
  <% text_is_white = var_class.include?('text-white') %>
  <% icon_style = text_is_white ? 'filter: invert(1) brightness(2);' : 'filter: none;' %>
  <% icon_html = image_tag(src, width: 20, height: 20, class: icon_class, alt: (icon_alt.present? ? icon_alt : ''), style: icon_style) %>
<% end %>

<div class="mt-2">
  <% if f %>
    <% opts = { class: classes, id: id, disabled: disabled } %>
    <% if data_action.present? %>
      <% opts[:data] = { action: data_action } %>
    <% end %>
    <% opts.delete_if { |_, v| v.nil? } %>
    <%= f.submit button_text, opts %>
  <% else %>
    <% link_opts = { class: classes, role: 'button', id: id, 'aria-disabled' => disabled ? 'true' : nil } %>
    <% if data_action.present? %>
      <% link_opts[:data] = { action: data_action } %>
    <% end %>
    <% link_opts.delete_if { |_, v| v.nil? } %>
    <%# アイコンがある場合はアイコンとテキストの間に全角スペースを1つ挿入する %>
    <% separator = icon_html.present? ? "　" : '' %>
    <% inner = (icon_html.to_s + separator + content_tag(:span, button_text, class: 'font-semibold')).html_safe %>
    <%= link_to inner, path, link_opts %>
  <% end %>
</div>